# å‰åç«¯åŸŸååˆ†ç¦»éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ“‹ åŸŸååˆ†é…ç­–ç•¥

### ğŸŒ åŸŸåèŒè´£åˆ’åˆ†
```
w4.799n.com (å‰ç«¯åŸŸå)
â”œâ”€â”€ é™æ€æ–‡ä»¶æœåŠ¡ (Vue.jsåº”ç”¨)
â”œâ”€â”€ å‰ç«¯è·¯ç”±æ”¯æŒ (SPA)
â””â”€â”€ APIè¯·æ±‚ä»£ç†åˆ°åç«¯åŸŸå

w3.799n.com (åç«¯åŸŸå)  
â”œâ”€â”€ APIæœåŠ¡ä»£ç† (æ‰€æœ‰è¯·æ±‚è½¬å‘åˆ°Docker)
â”œâ”€â”€ WebSocketæ”¯æŒ
â””â”€â”€ å¥åº·æ£€æŸ¥æ¥å£
```

## ğŸ”„ è¯·æ±‚æµç¨‹

### å‰ç«¯è®¿é—®æµç¨‹
```
ç”¨æˆ·æµè§ˆå™¨
    â†“ è®¿é—® https://w4.799n.com
w4.799n.com (Nginx)
    â†“ é™æ€æ–‡ä»¶ (/, /about, /loginç­‰)
Vue.js åº”ç”¨
    â†“ APIè°ƒç”¨
w3.799n.com (Nginxä»£ç†)
    â†“ è½¬å‘åˆ°
Dockerå®¹å™¨ (127.0.0.1:5000)
```

### APIè°ƒç”¨é“¾è·¯
```
å‰ç«¯ (w4.799n.com)
    â†“ axios.get('/api/users')
    â†“ è¢«ä»£ç†é…ç½®é‡å®šå‘åˆ°
åç«¯ (w3.799n.com/api/users)
    â†“ Nginxä»£ç†è½¬å‘
Docker Backend (127.0.0.1:5000/api/users)
    â†“ å“åº”æ•°æ®
å‰ç«¯æ¥æ”¶å“åº”
```

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

### å‰ç«¯é…ç½® (bt-panel-site.conf)
```nginx
server {
    server_name w4.799n.com;
    root /www/wwwroot/w4.799n.com;
    
    # é™æ€æ–‡ä»¶æœåŠ¡
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # APIä»£ç†åˆ°åç«¯åŸŸå
    location /api/ {
        proxy_pass http://w3.799n.com:5000;
        # CORS + å…¶ä»–é…ç½®
    }
}
```

### åç«¯é…ç½® (bt-panel-backend.conf)
```nginx
server {
    server_name w3.799n.com;
    
    # æ‰€æœ‰è¯·æ±‚ä»£ç†åˆ°Dockerå®¹å™¨
    location / {
        proxy_pass http://127.0.0.1:5000;
        # ä»£ç†é…ç½®
    }
}
```

## ğŸ› ï¸ éƒ¨ç½²æ­¥éª¤

### 1. å‰ç«¯ç«™ç‚¹è®¾ç½®
1. å®å¡”é¢æ¿åˆ›å»ºç«™ç‚¹ `w4.799n.com`
2. ä¸Šä¼ å‰ç«¯æ„å»ºæ–‡ä»¶åˆ° `/www/wwwroot/w4.799n.com/`
3. åº”ç”¨å‰ç«¯Nginxé…ç½® (`bt-panel-site.conf`)
4. é…ç½®SSLè¯ä¹¦

### 2. åç«¯ç«™ç‚¹è®¾ç½®
1. å®å¡”é¢æ¿åˆ›å»ºç«™ç‚¹ `w3.799n.com`
2. åº”ç”¨åç«¯Nginxé…ç½® (`bt-panel-backend.conf`)
3. é…ç½®SSLè¯ä¹¦
4. å¯åŠ¨Dockeråç«¯æœåŠ¡

### 3. å‰ç«¯APIé…ç½®
åœ¨å‰ç«¯é¡¹ç›®ä¸­é…ç½®APIåŸºç¡€URLï¼š

```javascript
// frontend/src/utils/api.js
const API_BASE_URL = process.env.NODE_ENV === 'production' 
  ? 'https://w3.799n.com'  // ç”Ÿäº§ç¯å¢ƒæŒ‡å‘åç«¯åŸŸå
  : 'http://localhost:5000';  // å¼€å‘ç¯å¢ƒæœ¬åœ°åç«¯

export const api = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000,
  withCredentials: true
});
```

## âœ… éªŒè¯æ¸…å•

### å‰ç«¯éªŒè¯ (w4.799n.com)
- [ ] é™æ€é¡µé¢è®¿é—®æ­£å¸¸
- [ ] å‰ç«¯è·¯ç”±å·¥ä½œ (åˆ·æ–°ä¸404)
- [ ] é™æ€èµ„æºåŠ è½½æ­£å¸¸
- [ ] SSLè¯ä¹¦æœ‰æ•ˆ

### åç«¯éªŒè¯ (w3.799n.com)
- [ ] APIå¥åº·æ£€æŸ¥: `curl https://w3.799n.com/api/health`
- [ ] ç›´æ¥APIè®¿é—®æ­£å¸¸
- [ ] CORSå¤´é…ç½®æ­£ç¡®
- [ ] SSLè¯ä¹¦æœ‰æ•ˆ

### é›†æˆéªŒè¯
- [ ] å‰ç«¯å¯ä»¥è°ƒç”¨åç«¯API
- [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] è·¨åŸŸé—®é¢˜è§£å†³
- [ ] WebSocketè¿æ¥æ­£å¸¸ (å¦‚æœä½¿ç”¨)

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. CORSé”™è¯¯**
```bash
# æ£€æŸ¥åç«¯Nginxé…ç½®ä¸­çš„CORSå¤´
curl -H "Origin: https://w4.799n.com" \
     -H "Access-Control-Request-Method: GET" \
     -H "Access-Control-Request-Headers: Authorization" \
     -X OPTIONS \
     https://w3.799n.com/api/health
```

**2. APIä»£ç†å¤±è´¥**
```bash
# æ£€æŸ¥å‰ç«¯Nginxé…ç½®çš„ä»£ç†è®¾ç½®
# ç¡®ä¿ proxy_pass æŒ‡å‘æ­£ç¡®çš„åç«¯åœ°å€
```

**3. SSLè¯ä¹¦é—®é¢˜**
```bash
# æ£€æŸ¥ä¸¤ä¸ªåŸŸåçš„è¯ä¹¦æ˜¯å¦éƒ½é…ç½®æ­£ç¡®
curl -I https://w4.799n.com
curl -I https://w3.799n.com
```

**4. DockeræœåŠ¡æ— æ³•è®¿é—®**
```bash
# æ£€æŸ¥Dockerå®¹å™¨çŠ¶æ€
docker ps
curl http://127.0.0.1:5000/api/health
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç¼“å­˜ç­–ç•¥
- å‰ç«¯é™æ€èµ„æºï¼šé•¿æœŸç¼“å­˜
- åç«¯APIå“åº”ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½®
- HTMLæ–‡ä»¶ï¼šä¸ç¼“å­˜ç¡®ä¿æ›´æ–°ç”Ÿæ•ˆ

### 2. è´Ÿè½½å‡è¡¡
å¦‚æœåç«¯æ‰©å±•å¤šä¸ªå®ä¾‹ï¼š
```nginx
upstream backend_pool {
    server 127.0.0.1:5001;
    server 127.0.0.1:5002;
    server 127.0.0.1:5003;
}

location / {
    proxy_pass http://backend_pool;
}
```

### 3. ç›‘æ§è®¾ç½®
- ç›‘æ§ä¸¤ä¸ªåŸŸåçš„å“åº”æ—¶é—´
- ç›‘æ§APIè°ƒç”¨æˆåŠŸç‡
- ç›‘æ§SSLè¯ä¹¦è¿‡æœŸæ—¶é—´

è¿™ç§åŸŸååˆ†ç¦»æ–¹æ¡ˆæä¾›äº†æ¸…æ™°çš„èŒè´£åˆ’åˆ†å’Œæ›´å¥½çš„æ‰©å±•æ€§ï¼